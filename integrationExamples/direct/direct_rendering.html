<!DOCTYPE html>
<html>
<head>
    <script>
      var delayContainer = false;
      function appendContainer(id) {
        var el = document.createElement('div');
        el.id = id;
        document.body.appendChild(el);
      }
    </script>

    <script>
      var adUnits = [
        {
          "code": "sky",
          "bids": [
            {
              "params": {
                "ssat": 1,
                "yl2": false,

                "host": "localhost:8305",
                "connectjsurl": "//js.lsd.test/userconnect.js",
                "sid": "39000",
                "path": "/hba"
              },
              "bidder": "stroeerCore"
            }
          ],
          "mediaTypes": {
            "banner": {
              "sizes": [
                [
                  800,
                  250
                ],
                [
                  770,
                  250
                ],
                [
                  468,
                  60
                ],
                [
                  234,
                  60
                ],
                [
                  728,
                  90
                ]
              ]
            }
          }
        }
      ]


      var pbjs = pbjs || {};
      pbjs.que = pbjs.que || [];

      pbjs.que.push(function () {
        pbjs.setConfig({
          bidderTimeout: 5000,
          priceGranularity: "auto",
          debug: true
        });
      });

    </script>

    <script>
        // Mock metatag.js. To fiddle around with while dev testing.

        var slotLifecycleMethods = ["sendPlacementCallingEvent", "loadProcessResponded", "updatePlacementParameters", "loadProcessRenderedResponse", "sendPlacementEmptyEvent", "loadProcessDone", "setIdsForSystem", "setFlag"];

        var Slot = function (name, id) {
          var that = this;
          var container = document.getElementById(id);

          this.getAdServerNode = function () {
            return container;
          }

          this.getName = function() {
            return name;
          }

          slotLifecycleMethods.forEach(function(methodName) {
            that[methodName] = function(){}
          })

          var intervalId = setInterval(function() {
            container = document.getElementById(id);
            if (container) {
              var event = new CustomEvent('metaTagSystemSlotContainerAvailable', {
                detail: {
                  passedObject: that
                }
              });
              window.dispatchEvent(event);
              clearInterval(intervalId);
            }
          }, 6000);
        }

        var SDG = {
          getCN: function() {
            return {
              getSlotByPosition: function(name) {
                return name === 'sky' ? fakeSlot : null;
              }
            }
          }
        }
    </script>


    <script src="/build/dev/prebid.js" async></script>

    <script>
      function kickoff() {
        pbjs.que.push(function () {
          pbjs.addAdUnits(adUnits);
          pbjs.requestBids({
            bidsBackHandler: bidsBackHandlerFn
          });
        });

        function bidsBackHandlerFn(bids, timeout, auctionId) {
          if (pbjs.adserverRequestSent) return;
          pbjs.adserverRequestSent = true;

          pbjs.que.push(function () {
            pbjs.directRender(bids, auctionId);

            // Adding container here to test delayed container
            if (delayContainer) {
              appendContainer('xyz');
            }
          });
        }
      }
    </script>
</head>

<body>
<h2>Direct Rendering Local Test</h2>

<script>
    kickoff();
</script>

<script>
    if (!delayContainer) {
      appendContainer('xyz');
    }
    var fakeSlot = new Slot('sky', 'xyz');
</script>

</body>

</html>
